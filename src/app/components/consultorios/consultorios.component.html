<!-- home.component.html -->
<div class="d-lg-none d-flex justify-content-between align-items-center p-2 bg-light border-bottom">
    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu"
        aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fa fa-list"></i>
    </button>
</div>

<div class="d-flex">
    <!-- Sidebar para todos los tamaños -->
    <app-sidebar></app-sidebar>

    <!-- Contenido principal -->
    <div class="flex-grow-1 p-4 dashboard">
        <div class="card mt-2">
            <div class="card-body">
                <div class="flex justify-content-between mb-3">
                    <h3 class="text-center">Menú de Consultorios</h3>
                    <p-button label="Crear consultorio" icon="pi pi-plus" severity="info" (onClick)="abrirFormulario()" />
                </div>

                <p-table [value]="consultorios" [paginator]="true" [rows]="10" responsiveLayout="scroll">
                    <ng-template pTemplate="header">
                    <tr>
                        <th>Código</th>
                        <th>Descripción</th>
                        <th>Representante</th>
                        <th>Piso</th>
                        <th>Aforo</th>
                        <th>Correo</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row>
                    <tr>
                        <td>{{ row.codigo }}</td>
                        <td>{{ row.descripcion }}</td>
                        <td>{{ row.nombre_representante }}</td>
                        <td>{{ row.piso_ubicacion }}</td>
                        <td>{{ row.aforo }}</td>
                        <td>{{ row.correo }}</td>
                        <td>{{ row.estado }}</td>
                        <td>
                            <p-button icon="pi pi-pencil" class="p-button-text p-button-sm" (onClick)="editarDatosConsultorio(row)" />
                            <p-button icon="pi pi-trash" class="p-button-text p-button-sm" (onClick)="borrarConsultorio(row.id)" />
                        </td>
                    </tr>
                    </ng-template>
                </p-table>

                <p-dialog 
                    header="{{ isEdit ? 'Editar' : 'Adicionar' }} Consultorio" 
                    [(visible)]="displayDialog" 
                    [modal]="true" 
                    [style]="{ width: '300px' }" 
                    [draggable]="false"
                    appendTo="body"
                    >
                    <div class="p-fluid grid p-formgrid">
                        <div class="p-fluid grid p-formgrid">
                            <p-floatlabel variant="on" class="col-12 md:col-6 mt-1">
                                <input 
                                    type="number"
                                    pInputText 
                                    id="codigo" 
                                    class="w-100" 
                                    [(ngModel)]="formData.codigo" 
                                    #codigo="ngModel"
                                    required 
                                    autocomplete="off" 
                                    max="99999"
                                    min="1"/>
                                <label for="codigo">Código</label>
                            </p-floatlabel>
                            <small class="p-error text-error-small" *ngIf="(codigo.invalid && (codigo.touched)) || codigo.errors?.['min'] > 0">
                                El código es requerido ,diferente de cero (0) y no mayor a 99999
                            </small>

                            <p-floatlabel variant="on" class="col-12 md:col-6 mt-3">
                                <input pInputText id="descripcion" class="w-100" [(ngModel)]="formData.descripcion" maxlength="300" />
                                <label for="descripcion">Descripción</label>
                            </p-floatlabel>

                            <p-floatlabel variant="on" class="col-12 md:col-6 mt-3">
                                <input 
                                    pInputText 
                                    id="representante" 
                                    class="w-100" 
                                    #representante="ngModel"
                                    required 
                                    autocomplete="off"
                                    [(ngModel)]="formData.nombre_representante" 
                                />
                                <label for="representante">Representante</label>
                            </p-floatlabel>
                            <small class="p-error text-error-small" *ngIf="(representante.invalid && (representante.touched))">
                                El representante es requerido
                            </small>

                            <p-floatlabel variant="on" class="col-12 md:col-6 mt-3">
                                <textarea pInputTextarea  id="info_recoleccion" class="w-100" [(ngModel)]="formData.info_recoleccion" maxlength="500" rows="3"> </textarea>
                                <label for="info_recoleccion">Información de recolección</label>
                            </p-floatlabel>

                            <p-floatlabel variant="on" class="col-12 md:col-6 mt-3">
                                <input 
                                    pInputText 
                                    id="piso" 
                                    class="w-100" 
                                    #piso="ngModel"
                                    required 
                                    autocomplete="off"
                                    [(ngModel)]="formData.piso_ubicacion"
                                    maxlength="20"
                                />
                                <label for="piso">Piso</label>
                            </p-floatlabel>
                            <small class="p-error text-error-small" *ngIf="(piso.invalid && (piso.touched))">
                                El piso del consultorio es requerido
                            </small>

                            <p-floatlabel variant="on" class="col-12 md:col-6 mt-3">
                                <input 
                                    type="number" 
                                    pInputText 
                                    id="aforo" 
                                    class="w-100" 
                                    #aforo="ngModel"
                                    required 
                                    autocomplete="off" 
                                    max="1000"
                                    [(ngModel)]="formData.aforo" 
                                />
                                <label for="aforo">Aforo</label>
                            </p-floatlabel>
                            <small class="p-error text-error-small" *ngIf="(aforo.invalid && (aforo.touched))">
                                El aforo del consultorio es requerido
                            </small>

                            <p-floatlabel variant="on" class="col-12 md:col-6 mt-3">
                                <input 
                                    type="email" 
                                    pInputText 
                                    id="correo" 
                                    class="w-100" 
                                    #correo="ngModel"
                                    required 
                                    autocomplete="off"
                                    [(ngModel)]="formData.correo" 
                                    pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                                />
                                <label for="correo">Correo</label>
                            </p-floatlabel>
                            <small class="p-error text-error-small" *ngIf="(correo.invalid && (correo.touched))">
                                El correo (e-mail) es requerido
                            </small>
                            <small class="p-error text-error-small" *ngIf="correo.touched && correo.errors?.['required']">
                                El correo es obligatorio.
                            </small>
                            <small class="p-error text-error-small" *ngIf="correo.touched && correo.errors?.['patern']">
                                El formato del correo no es válido.
                            </small>

                            <!-- <p-floatlabel variant="on" class="col-12 md:col-6 mt-3">
                                <input pInputText id="estado" class="w-100" [(ngModel)]="formData.estado" />
                                <label for="estado">Estado</label>
                            </p-floatlabel> -->

                            <!-- <p-floatlabel variant="on" class="col-12 md:col-6 mt-3">
                                <input type="number" pInputText id="usuario" class="w-100" [(ngModel)]="formData.id_usuario" />
                                <label for="usuario">Usuario ID</label>
                            </p-floatlabel> -->
                        </div>
                    </div>

                    <ng-template pTemplate="footer">
                        <div class="flex justify-content-end gap-2">
                            <p-button label="Cancelar" class="m-2" icon="pi pi-times" severity="secondary" (onClick)="displayDialog = false" />
                            <p-button 
                                label="Guardar" 
                                class="m-2" 
                                icon="pi pi-check" 
                                severity="info"
                                [disabled]="codigo.invalid || representante.invalid || aforo.invalid || piso.invalid || correo.invalid" 
                                (onClick)="crearActualizarConsultorio()" 
                            />
                        </div>
                    </ng-template>
                </p-dialog>
            </div>
        </div>
    </div>
</div>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
