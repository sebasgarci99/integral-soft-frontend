<!-- reg_vacunacion.component.html -->

<div class="d-lg-none d-flex justify-content-between align-items-center p-2 bg-light border-bottom">
    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" 
        data-bs-target="#sidebarMenu"
        aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fa fa-list"></i>
    </button>
</div>

<div class="d-flex">
    <app-sidebar></app-sidebar>

    <div class="flex-grow-1 p-4 dashboard">
        <div class="card mt-2">
            <div class="card-body">
                
                <div class="flex justify-content-between mb-3">
                    <h3 class="text-center">Registros de Vacunación</h3>
                </div>

                <!-- BUSCADOR -->
                <div class="flex justify-content-end mb-2">
                    <input 
                        #gbInput
                        pInputText 
                        type="text"
                        (input)="tablaPacientes.filterGlobal(gbInput.value, 'contains')" 
                        placeholder="Buscar paciente..."
                    />
                </div>

                <!-- TABLA DE PACIENTES -->
                <p-table 
                    #tablaPacientes
                    [value]="pacientes" 
                    responsiveLayout="scroll"
                    [paginator]="true" 
                    [rows]="10"
                    [globalFilterFields]="['nombres','apellidos','identificacion','telefono']">

                    <ng-template pTemplate="header">
                        <tr>
                            <th>Paciente</th>
                            <th>Identificación</th>
                            <th>Teléfono</th>
                            <th>Acciones</th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-row>
                        <tr>
                            <td>{{ row.nombres }} {{ row.apellidos }}</td>
                            <td>{{ row.identificacion }}</td>
                            <td>{{ row.telefono }}</td>
                            <td>
                                <p-button 
                                    icon="fa fa-plus" 
                                    class="p-button-text p-button-sm" 
                                    (onClick)="crearRegistroVacunacion(row)">
                                </p-button>

                                <p-button 
                                    icon="fa fa-syringe" 
                                    class="p-button-text p-button-sm" 
                                    label="Hist. Vacunas"
                                    severity="info"
                                    (onClick)="abrirHistoricoVacunas(row)">
                                </p-button>

                                <p-button 
                                    icon="fa fa-file-pdf" 
                                    class="p-button-text p-button-sm" 
                                    label="Hist. Consentimientos"
                                    severity="help"
                                    (onClick)="abrirHistoricoConsentimientos(row)">
                                </p-button>
                            </td>
                        </tr>
                    </ng-template>

                </p-table>

                <!-- DIALOG HISTORICO VACUNAS -->
                <p-dialog 
                    header="Histórico de Vacunas del Paciente"
                    [(visible)]="dialogVacunas"
                    [modal]="true"
                    [style]="{ width: '65vw' }"
                    appendTo="body"
                >
                    <p-table [value]="historicoVacunas" responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Vacuna</th>
                                <th>Nombre comercial</th>
                                <th>Fecha y hora</th>
                                <th>Dosis</th>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-v>
                            <tr>
                                <td>{{ v.nombre_vacuna }}</td>
                                <td>{{ v.presentacion_comercial }}</td>
                                <td>{{ v.fecha }}</td>
                                <td>{{ v.cantidad_dosis }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </p-dialog>

                <!-- DIALOG HISTORICO CONSENTIMIENTOS -->
                <p-dialog 
                    header="Histórico de Consentimientos"
                    [(visible)]="dialogConsentimientos"
                    [modal]="true"
                    [style]="{ width: '50vw' }"
                    appendTo="body"
                >
                    <p-table [value]="historicoConsentimientos" responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Paciente</th>
                                <th>Acudiente</th>
                                <th>Fecha</th>
                                <th>PDF</th>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-c>
                            <tr>
                                <td>{{ c.nombre_paciente }}</td>
                                <td>{{ c.acudiente }}</td>
                                <td>{{ c.fecha_reg }}</td>
                                <td>
                                    <p-button 
                                        icon="fa fa-file-pdf" 
                                        class="p-button-text p-button-sm"
                                        (onClick)="generarPDFConsentimiento(c)"
                                    ></p-button>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </p-dialog>

            </div>
        </div>
    </div>
</div>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
